<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√£o - GrydUserTenant Framework</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-6 py-8">
        <div class="bg-white rounded-lg shadow-md p-8">
            <div class="flex items-center mb-6">
                <a href="index.html" class="text-green-600 hover:text-green-800 mr-4">‚Üê Voltar</a>
                <h1 class="text-3xl font-bold text-gray-800">‚öôÔ∏è Configura√ß√£o</h1>
            </div>

            <div class="prose max-w-none">
                <h2>Configura√ß√£o do GrydUserTenant Framework</h2>
                <p>Framework para gerenciamento de relacionamentos entre usu√°rios e tenants, integrando com GrydAuthentication e GrydCrud.</p>

                <h2>üì¶ Instala√ß√£o</h2>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-2">Via Package Manager Console</h3>
                    <pre><code class="language-bash">Install-Package GrydUserTenant.Infrastructure</code></pre>
                </div>

                <h2>üöÄ Configura√ß√£o Autom√°tica de DbContext</h2>
                <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
                    <p class="text-blue-800"><strong>‚ö° Novo:</strong> O framework agora oferece configura√ß√£o autom√°tica dos DbSets para simplificar a integra√ß√£o!</p>
                </div>

                <h3>‚ú® Benef√≠cios da Configura√ß√£o Autom√°tica</h3>
                <ul class="list-disc pl-6 mb-4">
                    <li><strong>Configura√ß√£o Autom√°tica:</strong> DbSets de UserTenant s√£o configurados automaticamente</li>
                    <li><strong>Redu√ß√£o de C√≥digo:</strong> N√£o √© necess√°rio declarar manualmente cada DbSet</li>
                    <li><strong>Configura√ß√µes Corretas:</strong> As configura√ß√µes do framework s√£o aplicadas automaticamente</li>
                    <li><strong>Facilidade de Manuten√ß√£o:</strong> Atualiza√ß√µes no framework se propagam automaticamente</li>
                </ul>

                <h3>üõ†Ô∏è Op√ß√£o 1: Interface IUserTenantDbContext (Mais Flex√≠vel)</h3>
                <pre><code class="language-csharp">using GrydUserTenant.Infrastructure.Common.Interfaces;
using GrydUserTenant.Infrastructure.Extensions;

public class ApplicationDbContext : BaseDbContext, IUserTenantDbContext
{
    // DbSets de UserTenant implementados automaticamente via interface
    public DbSet&lt;UserTenant&gt; UserTenants =&gt; Set&lt;UserTenant&gt;();

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        base.OnModelCreating(modelBuilder);
        
        // Configura√ß√£o autom√°tica das entidades de UserTenant
        modelBuilder.ConfigureUserTenantEntities(this);
        
        // Configure suas entidades espec√≠ficas...
    }
}</code></pre>

                <h3>üéØ Op√ß√£o 2: BaseDbContextWithUserTenant (Mais Simples - RECOMENDADO)</h3>
                <pre><code class="language-csharp">using GrydUserTenant.Infrastructure.Data;

public class ApplicationDbContext : BaseDbContextWithUserTenant
{
    public ApplicationDbContext(DbContextOptions&lt;ApplicationDbContext&gt; options) 
        : base(options)
    {
    }

    // Apenas suas entidades espec√≠ficas
    public DbSet&lt;MyEntity&gt; MyEntities { get; set; }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        // Chama base que j√° configura tudo automaticamente
        base.OnModelCreating(modelBuilder);

        // Configure apenas suas entidades espec√≠ficas
        modelBuilder.ApplyConfiguration(new MyEntityConfiguration());
    }
}</code></pre>

                <h3>‚öôÔ∏è Op√ß√£o 3: Apenas o M√©todo de Extens√£o (M√°xima Flexibilidade)</h3>
                <pre><code class="language-csharp">using GrydUserTenant.Infrastructure.Extensions;

public class ApplicationDbContext : DbContext
{
    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        base.OnModelCreating(modelBuilder);
        
        // Aplica apenas as configura√ß√µes do framework
        modelBuilder.ApplyUserTenantConfigurations();
        
        // Voc√™ ainda precisa declarar os DbSets manualmente
    }
}</code></pre>

                <h2>ÔøΩ Registro de Servi√ßos</h2>
                <p>Configure os servi√ßos do GrydUserTenant Framework no Program.cs:</p>

                <pre><code class="language-csharp">using GrydUserTenant.Application;
using GrydUserTenant.Infrastructure;

var builder = WebApplication.CreateBuilder(args);

// Registrar servi√ßos do GrydUserTenant
builder.Services.AddApplicationGrydUserTenantServices();
builder.Services.AddInfrastructureGrydUserTenantServices(builder.Configuration);

var app = builder.Build();</code></pre>

                <h2>ÔøΩüîÑ Integra√ß√£o com M√∫ltiplos Frameworks</h2>
                <p>Para projetos que usam GrydAuthentication + GrydCrud + GrydUserTenant simultaneamente:</p>

                <pre><code class="language-csharp">using Microsoft.EntityFrameworkCore;
using GrydCrud.Infrastructure.EntityFramework.Context;
using GrydAuth.Infrastructure.Common.Interfaces;
using GrydAuth.Infrastructure.Extensions;
using GrydUserTenant.Infrastructure.Common.Interfaces;
using GrydUserTenant.Infrastructure.Extensions;

public class ApplicationDbContext : BaseDbContext, 
                                   IAuthenticationDbContext, 
                                   IUserTenantDbContext
{
    // GrydAuth entities
    public DbSet&lt;User&gt; Users =&gt; Set&lt;User&gt;();
    public DbSet&lt;Role&gt; Roles =&gt; Set&lt;Role&gt;();
    public DbSet&lt;Permission&gt; Permissions =&gt; Set&lt;Permission&gt;();
    public DbSet&lt;UserRole&gt; UserRoles =&gt; Set&lt;UserRole&gt;();
    public DbSet&lt;UserPermission&gt; UserPermissions =&gt; Set&lt;UserPermission&gt;();
    public DbSet&lt;RolePermission&gt; RolePermissions =&gt; Set&lt;RolePermission&gt;();
    public DbSet&lt;RefreshToken&gt; RefreshTokens =&gt; Set&lt;RefreshToken&gt;();
    
    // GrydUserTenant entities
    public DbSet&lt;UserTenant&gt; UserTenants =&gt; Set&lt;UserTenant&gt;();
    
    // Suas entidades espec√≠ficas
    public DbSet&lt;MyEntity&gt; MyEntities { get; set; }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        // GrydCrud configura√ß√µes (multi-tenancy, audit, etc.)
        base.OnModelCreating(modelBuilder);

        // Configura√ß√µes autom√°ticas dos frameworks
        modelBuilder.ConfigureAuthenticationEntities(this);
        modelBuilder.ConfigureUserTenantEntities(this);

        // Suas configura√ß√µes espec√≠ficas
        modelBuilder.ApplyConfiguration(new MyEntityConfiguration());
    }
}</code></pre>

                <div class="bg-green-50 border-l-4 border-green-400 p-4 my-6">
                    <p class="text-green-800"><strong>üí° Dica:</strong> A integra√ß√£o entre os frameworks √© autom√°tica - as relacionamentos entre User (GrydAuth) e UserTenant s√£o configurados automaticamente!</p>
                </div>

                <h2>üìã Checklist de Configura√ß√£o</h2>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <ul class="space-y-2">
                        <li>‚úÖ Adicionar refer√™ncia ao <code>GrydUserTenant.Infrastructure</code></li>
                        <li>‚úÖ Implementar <code>IUserTenantDbContext</code> OU herdar de <code>BaseDbContextWithUserTenant</code></li>
                        <li>‚úÖ Atualizar <code>OnModelCreating</code> para usar <code>ConfigureUserTenantEntities()</code></li>
                        <li>‚úÖ Testar migration e funcionamento</li>
                        <li>‚úÖ Verificar se os relacionamentos com User est√£o funcionando</li>
                    </ul>
                </div>

                <h2>üîß Configura√ß√µes Autom√°ticas Inclu√≠das</h2>
                <ul class="list-disc pl-6 mb-4">
                    <li><strong>UserTenantConfiguration:</strong> Configura√ß√£o completa da entidade UserTenant</li>
                    <li><strong>Relacionamentos:</strong> FK para User (GrydAuth) configurada automaticamente</li>
                    <li><strong>√çndices:</strong> √çndices de performance para consultas frequentes</li>
                    <li><strong>Valida√ß√µes:</strong> Constraints e valida√ß√µes de dom√≠nio</li>
                    <li><strong>Soft Delete:</strong> Filtros globais para exclus√£o l√≥gica</li>
                    <li><strong>Multi-tenancy:</strong> Suporte completo para multi-tenancy</li>
                </ul>

                <h2>üöÄ Para Novos Projetos</h2>
                <div class="bg-blue-50 p-4 rounded-lg">
                    <p><strong>Recomenda√ß√£o:</strong> Use as classes base combinadas para m√°xima simplicidade:</p>
                    <ol class="list-decimal pl-6 mt-2">
                        <li>Herde de <code>BaseDbContext</code> (GrydCrud)</li>
                        <li>Implemente <code>IAuthenticationDbContext</code> + <code>IUserTenantDbContext</code></li>
                        <li>Use os m√©todos de extens√£o <code>ConfigureAuthenticationEntities()</code> + <code>ConfigureUserTenantEntities()</code></li>
                        <li>Declare apenas suas entidades espec√≠ficas</li>
                        <li>Pronto! Auth + CRUD + UserTenant + Multi-tenancy funcionando</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        hljs.highlightAll();
    </script>
</body>
</html>
