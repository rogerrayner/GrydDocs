<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Services - GrydAuthentication Framework</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-6 py-8">
        <div class="bg-white rounded-lg shadow-md p-8">
            <div class="flex items-center mb-6">
                <a href="index.html" class="text-green-600 hover:text-green-800 mr-4">‚Üê Voltar</a>
                <h1 class="text-3xl font-bold text-gray-800">üîß Services</h1>
            </div>

            <div class="prose max-w-none">
                <h2>Services Implementados no GrydAuthentication Framework</h2>
                <p>Documenta√ß√£o dos services realmente implementados no c√≥digo fonte do framework.</p>

                <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500 my-6">
                    <h3 class="text-blue-800 font-semibold">üìã Services Dispon√≠veis</h3>
                    <p class="text-blue-700">O framework possui as seguintes interfaces e implementa√ß√µes:</p>
                </div>

                <h2>üîê Authentication Services</h2>

                <h3>IAuthenticationService</h3>
                <pre><code class="language-csharp">// IAuthenticationService.cs (implementado)
public interface IAuthenticationService
{
    Task&lt;Result&lt;AuthenticationResult&gt;&gt; AuthenticateAsync(string email, string password, CancellationToken cancellationToken = default);
    Task&lt;Result&lt;AuthenticationResult&gt;&gt; SocialAuthenticateAsync(string provider, string accessToken, CancellationToken cancellationToken = default);
    Task&lt;Result&lt;string&gt;&gt; GenerateJwtTokenAsync(Guid userId, CancellationToken cancellationToken = default);
    Task&lt;Result&lt;ClaimsPrincipal&gt;&gt; ValidateTokenAsync(string token, CancellationToken cancellationToken = default);
    Task&lt;Result&gt;&gt; RevokeTokenAsync(string token, CancellationToken cancellationToken = default);
}</code></pre>

                <h3>IJwtTokenService</h3>
                <pre><code class="language-csharp">// IJwtTokenService.cs (implementado)
public interface IJwtTokenService
{
    string GenerateToken(Guid userId, string email, IEnumerable&lt;string&gt; roles, IEnumerable&lt;string&gt; permissions);
    ClaimsPrincipal? ValidateToken(string token);
    bool IsTokenValid(string token);
    DateTime GetTokenExpiration(string token);
}</code></pre>

                <h3>IPasswordHasher</h3>
                <pre><code class="language-csharp">// IPasswordHasher.cs (implementado)
public interface IPasswordHasher
{
    string HashPassword(string password);
    bool VerifyPassword(string password, string hashedPassword);
}</code></pre>

                <h3>IEmailService</h3>
                <pre><code class="language-csharp">// IEmailService.cs (implementado)
public interface IEmailService
{
    Task SendEmailAsync(string to, string subject, string body, CancellationToken cancellationToken = default);
    Task SendWelcomeEmailAsync(string to, string firstName, CancellationToken cancellationToken = default);
    Task SendPasswordResetEmailAsync(string to, string resetToken, CancellationToken cancellationToken = default);
}</code></pre>

                <h3>ICurrentUserService</h3>
                <pre><code class="language-csharp">// ICurrentUserService.cs (implementado)
public interface ICurrentUserService
{
    Guid? UserId { get; }
    string? Email { get; }
    bool IsAuthenticated { get; }
    bool IsInRole(string role);
    bool HasPermission(string permission);
    IEnumerable&lt;string&gt; GetRoles();
    IEnumerable&lt;string&gt; GetPermissions();
}</code></pre>

                <h2>üè¢ Auth0 Integration</h2>

                <h3>IAuth0Service</h3>
                <pre><code class="language-csharp">// IAuth0Service.cs (implementado)
public interface IAuth0Service
{
    Task&lt;Result&lt;Auth0UserInfo&gt;&gt; AuthenticateUserAsync(string email, string password, CancellationToken cancellationToken = default);
    Task&lt;Result&lt;Auth0UserInfo&gt;&gt; AuthenticateSocialUserAsync(string provider, string accessToken, CancellationToken cancellationToken = default);
    Task&lt;Result&lt;Auth0UserInfo&gt;&gt; CreateUserAsync(string email, string password, string? firstName = null, string? lastName = null, CancellationToken cancellationToken = default);
}</code></pre>

                <h3>Auth0Service Implementation</h3>
                <pre><code class="language-csharp">// Auth0Service.cs (implementado)
public class Auth0Service : IAuth0Service
{
    private readonly IAuthenticationApiClient _authenticationClient;
    private readonly IManagementApiClient _managementClient;
    private readonly Auth0Settings _auth0Settings;
    private readonly ILogger&lt;Auth0Service&gt; _logger;

    public Auth0Service(
        IAuthenticationApiClient authenticationClient,
        IManagementApiClient managementClient,
        IConfiguration configuration,
        ILogger&lt;Auth0Service&gt; logger)
    {
        // Implementation available in codebase
    }

    public async Task&lt;Result&lt;Auth0UserInfo&gt;&gt; AuthenticateUserAsync(string email, string password, CancellationToken cancellationToken = default)
    {
        // Real implementation for Auth0 authentication
    }

    public async Task&lt;Result&lt;Auth0UserInfo&gt;&gt; AuthenticateSocialUserAsync(string provider, string accessToken, CancellationToken cancellationToken = default)
    {
        // Real implementation for social authentication
    }
}</code></pre>

                <h2>üóÉÔ∏è Data Transfer Objects</h2>

                <h3>UserDto</h3>
                <pre><code class="language-csharp">// UserDto.cs (implementado)
public class UserDto
{
    public Guid Id { get; set; }
    public string Email { get; set; } = string.Empty;
    public string? FirstName { get; set; }
    public string? LastName { get; set; }
    public string? Auth0UserId { get; set; }
    public bool IsActive { get; set; }
    public DateTime? LastLoginAt { get; set; }
    public string? ProfilePictureUrl { get; set; }
    public string? PhoneNumber { get; set; }
    public DateTime CreatedAt { get; set; }
    public DateTime? UpdatedAt { get; set; }
    public List&lt;RoleDto&gt; Roles { get; set; } = new();
    public List&lt;PermissionDto&gt; DirectPermissions { get; set; } = new();
    public List&lt;string&gt; AllPermissions { get; set; } = new();
}</code></pre>

                <h3>RoleDto</h3>
                <pre><code class="language-csharp">// RoleDto.cs (implementado)
public class RoleDto
{
    public Guid Id { get; set; }
    public string Name { get; set; } = string.Empty;
    public string? Description { get; set; }
    public bool IsSystemRole { get; set; }
    public DateTime CreatedAt { get; set; }
    public List&lt;PermissionDto&gt; Permissions { get; set; } = new();
}</code></pre>

                <h3>PermissionDto</h3>
                <pre><code class="language-csharp">// PermissionDto.cs (implementado)
public class PermissionDto
{
    public Guid Id { get; set; }
    public string Name { get; set; } = string.Empty;
    public string? Description { get; set; }
    public string? Category { get; set; }
    public bool IsSystemPermission { get; set; }
    public DateTime CreatedAt { get; set; }
}</code></pre>

                <h3>Auth0UserInfo</h3>
                <pre><code class="language-csharp">// Auth0UserInfo.cs (implementado)
public class Auth0UserInfo
{
    public string UserId { get; set; } = string.Empty;
    public string Email { get; set; } = string.Empty;
    public string? FirstName { get; set; }
    public string? LastName { get; set; }
    public string? Picture { get; set; }
    public bool EmailVerified { get; set; }
    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
}</code></pre>

                <h2>üìã CQRS Commands & Queries</h2>

                <h3>Authentication Commands</h3>
                <pre><code class="language-csharp">// AuthenticationCommands.cs (implementado)
public class LoginCommand : IRequest&lt;Result&lt;AuthenticationResult&gt;&gt;
{
    public string Email { get; set; } = string.Empty;
    public string Password { get; set; } = string.Empty;
}

public class SocialLoginCommand : IRequest&lt;Result&lt;AuthenticationResult&gt;&gt;
{
    public string Provider { get; set; } = string.Empty;
    public string AccessToken { get; set; } = string.Empty;
}

public class RefreshTokenCommand : IRequest&lt;Result&lt;AuthenticationResult&gt;&gt;
{
    public string RefreshToken { get; set; } = string.Empty;
}

public class LogoutCommand : IRequest&lt;Result&gt;
{
    public string Token { get; set; } = string.Empty;
}</code></pre>

                <h3>User Queries</h3>
                <pre><code class="language-csharp">// User Queries (implementado)
public class GetUsersQuery : IRequest&lt;Result&lt;PagedResult&lt;UserDto&gt;&gt;&gt;
{
    public int Page { get; set; } = 1;
    public int Size { get; set; } = 10;
    public string? Search { get; set; }
    public string? SortBy { get; set; }
    public string? SortDirection { get; set; }
}

public class GetUserByIdQuery : IRequest&lt;Result&lt;UserDto&gt;&gt;
{
    public Guid Id { get; set; }
}</code></pre>

                <h3>Role Queries</h3>
                <pre><code class="language-csharp">// Role Queries (implementado)
public class GetAllRolesQuery : IRequest&lt;Result&lt;List&lt;RoleDto&gt;&gt;&gt;
{
    public bool IncludeSystemRoles { get; set; } = true;
}

public class GetRoleByIdQuery : IRequest&lt;Result&lt;RoleDto&gt;&gt;
{
    public Guid Id { get; set; }
}

public class GetRoleByNameQuery : IRequest&lt;Result&lt;RoleDto&gt;&gt;
{
    public string Name { get; set; } = string.Empty;
}</code></pre>

                <h2>üèóÔ∏è Dependency Injection Setup</h2>
                <p>Services registrados via InfrastructureServiceRegistration:</p>

                <pre><code class="language-csharp">// InfrastructureServiceRegistration.cs (implementado)
public static class InfrastructureServiceRegistration
{
    public static IServiceCollection AddInfrastructureGrydAuthServices(this IServiceCollection services, IConfiguration configuration)
    {
        // Entity Framework
        services.AddDbContext&lt;AuthenticationDbContext&gt;(options =>
            options.UseSqlServer(configuration.GetConnectionString("DefaultConnection")));

        // Repositories
        services.AddScoped&lt;IUserRepository, UserRepository&gt;();
        services.AddScoped&lt;IRoleRepository, RoleRepository&gt;();
        services.AddScoped&lt;IPermissionRepository, PermissionRepository&gt;();

        // Application Services
        services.AddScoped&lt;IAuthenticationService, AuthenticationService&gt;();
        services.AddScoped&lt;IJwtTokenService, JwtTokenService&gt;();
        services.AddScoped&lt;ICurrentUserService, CurrentUserService&gt;();
        services.AddScoped&lt;IPasswordHasher, PasswordHasher&gt;();
        services.AddScoped&lt;IEmailService, EmailService&gt;();

        // JWT Configuration
        AddJwtAuthentication(services, configuration);

        return services;
    }

    private static void AddJwtAuthentication(IServiceCollection services, IConfiguration configuration)
    {
        // JWT configuration implementation
    }
}</code></pre>

                <h3>Auth0 Services Registration</h3>
                <pre><code class="language-csharp">// Auth0ServiceRegistration.cs (implementado)
public static class Auth0ServiceRegistration
{
    public static IServiceCollection AddAuth0GrydAuthServices(this IServiceCollection services, IConfiguration configuration)
    {
        // Auth0 configuration
        services.Configure&lt;Auth0Settings&gt;(configuration.GetSection("Auth0"));

        // Auth0 clients
        services.AddSingleton&lt;IAuthenticationApiClient&gt;(provider =&gt;
        {
            var settings = provider.GetRequiredService&lt;IOptions&lt;Auth0Settings&gt;&gt;().Value;
            return new AuthenticationApiClient(settings.Domain);
        });

        services.AddScoped&lt;IManagementApiClient&gt;(provider =&gt;
        {
            var settings = provider.GetRequiredService&lt;IOptions&lt;Auth0Settings&gt;&gt;().Value;
            return new ManagementApiClient(settings.ManagementApiToken, settings.Domain);
        });

        // Auth0 service
        services.AddScoped&lt;IAuth0Service, Auth0Service&gt;();

        return services;
    }
}</code></pre>

                <h2>üîß Application Services Registration</h2>
                <pre><code class="language-csharp">// ApplicationServiceRegistration.cs (implementado)
public static class ApplicationServiceRegistration
{
    public static IServiceCollection AddApplicationGrydAuthServices(this IServiceCollection services)
    {
        // MediatR registration
        services.AddMediatR(cfg =&gt;
        {
            cfg.RegisterServicesFromAssembly(Assembly.GetExecutingAssembly());
            cfg.RegisterServicesFromAssembly(typeof(LoginCommand).Assembly);
        });

        // FluentValidation registration
        services.AddValidatorsFromAssembly(Assembly.GetExecutingAssembly());
        services.AddValidatorsFromAssembly(typeof(LoginCommand).Assembly);

        return services;
    }
}</code></pre>

                <h2>‚ùå Services N√ÉO Implementados</h2>
                <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-500">
                    <h3 class="text-red-800 font-semibold mb-2">Funcionalidades Ausentes</h3>
                    <p class="text-red-700 text-sm mb-2">Os seguintes services n√£o est√£o implementados:</p>
                    <ul class="text-sm text-red-700 space-y-1">
                        <li>‚Ä¢ ISessionService / SessionService</li>
                        <li>‚Ä¢ ITwoFactorService / TwoFactorService</li>
                        <li>‚Ä¢ ICacheService / CacheService</li>
                        <li>‚Ä¢ IAuditService / AuditService</li>
                        <li>‚Ä¢ IFileStorageService / FileStorageService</li>
                        <li>‚Ä¢ ITemplateService / TemplateService</li>
                        <li>‚Ä¢ IValidationService / ValidationService</li>
                        <li>‚Ä¢ IEncryptionService / EncryptionService</li>
                        <li>‚Ä¢ IPermissionService / PermissionService</li>
                        <li>‚Ä¢ Background Services (cleanup, etc.)</li>
                    </ul>
                </div>

                <h2>üß™ Testing</h2>
                <p>O framework possui testes unit√°rios para alguns controllers:</p>

                <pre><code class="language-csharp">// AuthControllerTests.cs (implementado)
/// &lt;summary&gt;
/// Unit tests for AuthController
/// Tests all authentication endpoints including login, social login, refresh token, logout, get current user, and validate token
/// &lt;/summary&gt;
public class AuthControllerTests
{
    // Test implementations available in codebase
}</code></pre>

                <div class="bg-green-50 p-6 rounded-lg border border-green-200 my-8">
                    <h3 class="font-semibold text-green-800 mb-4">‚úÖ Services Implementados</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-green-700">
                        <div>
                            <h4 class="font-semibold mb-2">üîê Authentication:</h4>
                            <ul class="space-y-1">
                                <li>‚Ä¢ IAuthenticationService</li>
                                <li>‚Ä¢ IJwtTokenService</li>
                                <li>‚Ä¢ IPasswordHasher</li>
                                <li>‚Ä¢ ICurrentUserService</li>
                                <li>‚Ä¢ IEmailService</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">üè¢ Auth0 Integration:</h4>
                            <ul class="space-y-1">
                                <li>‚Ä¢ IAuth0Service</li>
                                <li>‚Ä¢ Auth0Settings configuration</li>
                                <li>‚Ä¢ Social provider support</li>
                                <li>‚Ä¢ Management API client</li>
                                <li>‚Ä¢ Authentication API client</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">üìã CQRS/Data:</h4>
                            <ul class="space-y-1">
                                <li>‚Ä¢ MediatR commands/queries</li>
                                <li>‚Ä¢ FluentValidation</li>
                                <li>‚Ä¢ Entity Framework repos</li>
                                <li>‚Ä¢ DTOs para transfer√™ncia</li>
                                <li>‚Ä¢ Result pattern</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-8">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h3 class="font-semibold text-blue-800 mb-2">üéÆ Controllers</h3>
                        <p class="text-sm text-blue-600 mb-3">Documenta√ß√£o dos endpoints dispon√≠veis</p>
                        <a href="controllers.html" class="text-blue-600 text-sm font-medium hover:underline">
                            Ver Controllers ‚Üí
                        </a>
                    </div>
                    
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                        <h3 class="font-semibold text-purple-800 mb-2">üè† Home</h3>
                        <p class="text-sm text-purple-600 mb-3">Voltar √† documenta√ß√£o principal</p>
                        <a href="index.html" class="text-purple-600 text-sm font-medium hover:underline">
                            Voltar ao In√≠cio ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>hljs.highlightAll();</script>
</body>
</html>
