<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth0 Integration - GrydAuthentication Framework</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-6 py-8">
        <div class="bg-white rounded-lg shadow-md p-8">
            <div class="flex items-center mb-6">
                <a href="index.html" class="text-green-600 hover:text-green-800 mr-4">‚Üê Voltar</a>
                <h1 class="text-3xl font-bold text-gray-800">üîê Auth0 Integration</h1>
            </div>

            <div class="prose max-w-none">
                <h2>Vis√£o Geral</h2>
                <p>O GrydAuthentication Framework oferece integra√ß√£o completa com Auth0, fornecendo autentica√ß√£o robusta e gerenciamento de usu√°rios atrav√©s do servi√ßo <code>Auth0Service</code>.</p>

                <h2>Configura√ß√£o</h2>
                <h3>1. Auth0Settings</h3>
                <pre><code class="language-csharp">public class Auth0Settings
{
    public string Domain { get; set; } = string.Empty;
    public string ClientId { get; set; } = string.Empty;
    public string ClientSecret { get; set; } = string.Empty;
    public string Audience { get; set; } = string.Empty;
    public string ManagementApiAudience { get; set; } = string.Empty;
    public string Scope { get; set; } = string.Empty;
    public string ConnectionName { get; set; } = "Username-Password-Authentication";
    public Dictionary&lt;string, SocialProvider&gt; SocialProviders { get; set; } = new();
}</code></pre>

                <h3>2. appsettings.json</h3>
                <pre><code class="language-json">{
  "Auth0": {
    "Domain": "your-tenant.auth0.com",
    "ClientId": "your-client-id",
    "ClientSecret": "your-client-secret",
    "Audience": "your-api-identifier",
    "ManagementApiAudience": "https://your-tenant.auth0.com/api/v2/",
    "Scope": "openid profile email",
    "ConnectionName": "Username-Password-Authentication",
    "SocialProviders": {
      "google": {
        "Name": "Google",
        "ConnectionName": "google-oauth2",
        "Enabled": true
      },
      "facebook": {
        "Name": "Facebook", 
        "ConnectionName": "facebook",
        "Enabled": true
      }
    }
  }
}</code></pre>

                <h2>Funcionalidades do Auth0Service</h2>

                <h3>1. Autentica√ß√£o com Email/Password</h3>
                <pre><code class="language-csharp">public async Task&lt;Result&lt;Auth0UserInfo&gt;&gt; AuthenticateUserAsync(
    string email, 
    string password, 
    CancellationToken cancellationToken = default)
{
    try
    {
        var request = new ResourceOwnerTokenRequest
        {
            ClientId = _auth0Settings.ClientId,
            ClientSecret = _auth0Settings.ClientSecret,
            Username = email,
            Password = password,
            Realm = _auth0Settings.ConnectionName,
            Audience = _auth0Settings.ManagementApiAudience,
            Scope = _auth0Settings.Scope
        };

        var response = await _authenticationClient.GetTokenAsync(request);
        var userInfo = await _authenticationClient.GetUserInfoAsync(response.AccessToken);
        
        return Result&lt;Auth0UserInfo&gt;.Success(MapToAuth0UserInfo(userInfo));
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "Error during Auth0 authentication for email: {Email}", email);
        return Result&lt;Auth0UserInfo&gt;.Failure("Authentication failed");
    }
}</code></pre>

                <h3>2. Autentica√ß√£o Social</h3>
                <pre><code class="language-csharp">public async Task&lt;Result&lt;Auth0UserInfo&gt;&gt; AuthenticateSocialUserAsync(
    string provider, 
    string accessToken, 
    CancellationToken cancellationToken = default)
{
    try
    {
        var socialUserInfo = await GetSocialUserInfoAsync(provider, accessToken);
        
        if (socialUserInfo == null)
        {
            return Result&lt;Auth0UserInfo&gt;.Failure("Failed to retrieve social user information");
        }

        return Result&lt;Auth0UserInfo&gt;.Success(socialUserInfo);
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "Error during social authentication with provider: {Provider}", provider);
        return Result&lt;Auth0UserInfo&gt;.Failure("Social authentication failed");
    }
}</code></pre>

                <h3>3. Cria√ß√£o de Usu√°rios</h3>
                <pre><code class="language-csharp">public async Task&lt;Result&lt;Auth0UserInfo&gt;&gt; CreateUserAsync(
    string email, 
    string password, 
    string? firstName = null, 
    string? lastName = null, 
    CancellationToken cancellationToken = default)
{
    try
    {
        var request = new UserCreateRequest
        {
            Email = email,
            Password = password,
            Connection = _auth0Settings.ConnectionName,
            EmailVerified = false
        };

        if (!string.IsNullOrEmpty(firstName) || !string.IsNullOrEmpty(lastName))
        {
            request.UserMetadata = new
            {
                first_name = firstName,
                last_name = lastName
            };
        }

        var user = await _managementClient.Users.CreateAsync(request);
        return Result&lt;Auth0UserInfo&gt;.Success(MapToAuth0UserInfo(user));
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "Error creating user in Auth0: {Email}", email);
        return Result&lt;Auth0UserInfo&gt;.Failure("Failed to create user");
    }
}</code></pre>

                <h3>4. Gerenciamento de Usu√°rios</h3>
                <pre><code class="language-csharp">// Buscar usu√°rio por ID
public async Task&lt;Result&lt;Auth0UserInfo&gt;&gt; GetUserAsync(string auth0UserId, CancellationToken cancellationToken = default)

// Buscar usu√°rio por email
public async Task&lt;Result&lt;Auth0UserInfo&gt;&gt; GetUserAsyncByEmail(string email, CancellationToken cancellationToken = default)

// Atualizar usu√°rio
public async Task&lt;Result&gt; UpdateUserAsync(string auth0UserId, Auth0UpdateUserRequest request, CancellationToken cancellationToken = default)

// Deletar usu√°rio
public async Task&lt;Result&gt; DeleteUserAsync(string auth0UserId, CancellationToken cancellationToken = default)</code></pre>

                <h2>Registro de Servi√ßos</h2>
                <h3>Auth0ServiceRegistration</h3>
                <pre><code class="language-csharp">public static class Auth0ServiceRegistration
{
    public static IServiceCollection AddAuth0GrydAuthServices(this IServiceCollection services, IConfiguration configuration)
    {
        var auth0Settings = new Auth0Settings();
        configuration.GetSection("Auth0").Bind(auth0Settings);

        // Register Auth0 clients
        services.AddSingleton&lt;IAuthenticationApiClient&gt;(provider =&gt;
            new AuthenticationApiClient(auth0Settings.Domain));

        services.AddSingleton&lt;IManagementApiClient&gt;(provider =&gt;
        {
            var tokenProvider = provider.GetRequiredService&lt;IAuth0ManagementTokenProvider&gt;();
            var token = tokenProvider.GetTokenAsync().Result;
            return new ManagementApiClient(token, auth0Settings.Domain);
        });

        // Register Auth0 service
        services.AddScoped&lt;IAuth0Service, Auth0Service&gt;();
        
        return services;
    }
}</code></pre>

                <h2>Uso no Program.cs</h2>
                <pre><code class="language-csharp">var builder = WebApplication.CreateBuilder(args);

// Add Gryd Authentication services
builder.Services.AddGrydAuthentication(builder.Configuration);

// Add Auth0 integration
builder.Services.AddAuth0GrydAuthServices(builder.Configuration);

var app = builder.Build();</code></pre>

                <h2>Models e DTOs</h2>
                
                <h3>Auth0UserInfo</h3>
                <pre><code class="language-csharp">public class Auth0UserInfo
{
    public string UserId { get; set; } = string.Empty;
    public string Email { get; set; } = string.Empty;
    public string? FirstName { get; set; }
    public string? LastName { get; set; }
    public string? ProfilePictureUrl { get; set; }
    public bool EmailVerified { get; set; }
    public DateTime CreatedAt { get; set; }
    public DateTime? LastLoginAt { get; set; }
}</code></pre>

                <h3>SocialProvider</h3>
                <pre><code class="language-csharp">public class SocialProvider
{
    public string Name { get; set; } = string.Empty;
    public string ConnectionName { get; set; } = string.Empty;
    public bool Enabled { get; set; } = true;
}</code></pre>

                <h2>Interface IAuth0Service</h2>
                <pre><code class="language-csharp">public interface IAuth0Service
{
    Task&lt;Result&lt;Auth0UserInfo&gt;&gt; AuthenticateUserAsync(string email, string password, CancellationToken cancellationToken = default);
    Task&lt;Result&lt;Auth0UserInfo&gt;&gt; AuthenticateSocialUserAsync(string provider, string accessToken, CancellationToken cancellationToken = default);
    Task&lt;Result&lt;Auth0UserInfo&gt;&gt; CreateUserAsync(string email, string password, string? firstName = null, string? lastName = null, CancellationToken cancellationToken = default);
    Task&lt;Result&gt; UpdateUserAsync(string auth0UserId, Auth0UpdateUserRequest request, CancellationToken cancellationToken = default);
    Task&lt;Result&gt; DeleteUserAsync(string auth0UserId, CancellationToken cancellationToken = default);
    Task&lt;Result&lt;Auth0UserInfo&gt;&gt; GetUserAsync(string auth0UserId, CancellationToken cancellationToken = default);
    Task&lt;Result&lt;Auth0UserInfo&gt;&gt; GetUserAsyncByEmail(string email, CancellationToken cancellationToken = default);
}</code></pre>

                <h2>Exemplo de Uso</h2>
                <pre><code class="language-csharp">public class AuthenticationService : IAuthenticationService
{
    private readonly IAuth0Service _auth0Service;

    public AuthenticationService(IAuth0Service auth0Service)
    {
        _auth0Service = auth0Service;
    }

    public async Task&lt;Result&lt;AuthenticationResult&gt;&gt; AuthenticateAsync(string email, string password, CancellationToken cancellationToken = default)
    {
        var auth0Result = await _auth0Service.AuthenticateUserAsync(email, password, cancellationToken);
        
        if (!auth0Result.IsSuccess)
        {
            return Result&lt;AuthenticationResult&gt;.Failure("Authentication failed");
        }

        // Processar usu√°rio e gerar JWT token
        // ...
        
        return Result&lt;AuthenticationResult&gt;.Success(authResult);
    }
}</code></pre>
            </div>
        </div>
    </div>

    <script>hljs.highlightAll();</script>
</body>
</html>
