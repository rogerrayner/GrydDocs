<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controllers - GrydAuthentication Framework</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-6 py-8">
        <div class="bg-white rounded-lg shadow-md p-8">
            <div class="flex items-center mb-6">
                <a href="index.html" class="text-green-600 hover:text-green-800 mr-4">‚Üê Voltar</a>
                <h1 class="text-3xl font-bold text-gray-800">üéÆ API Reference - Controllers</h1>
            </div>

            <div class="prose max-w-none">
                <h2>API Reference Baseada no C√≥digo Real</h2>
                <p>Documenta√ß√£o dos endpoints do GrydAuthentication Framework conforme implementado no c√≥digo fonte.</p>

                <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500 my-6">
                    <h3 class="text-blue-800 font-semibold">üìã Base URL</h3>
                    <p class="text-blue-700 mb-0">
                        <strong>Desenvolvimento:</strong> <code>https://localhost:7001/api</code><br>
                        <strong>Produ√ß√£o:</strong> <code>https://api.yourapp.com/api</code>
                    </p>
                </div>

                <h2>üîê AuthController</h2>
                <p>Controller para autentica√ß√£o, gerenciado via CQRS com MediatR.</p>

                <h3>POST /api/auth/login</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Autenticar usu√°rio com email e senha</p>
                    <p class="text-sm text-gray-600">Retorna JWT token e informa√ß√µes do usu√°rio</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 my-6">
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì§ Request (LoginCommand)</h4>
                        <pre><code class="language-json">{
  "email": "user@example.com",
  "password": "UserPassword123!"
}</code></pre>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì• Response (AuthenticationResult)</h4>
                        <pre><code class="language-json">{
  "isSuccess": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IlJlZnJlc2gi...",
    "expiresAt": "2024-03-15T14:30:00Z",
    "user": {
      "id": "123e4567-e89b-12d3-a456-426614174000",
      "email": "user@example.com",
      "firstName": "User",
      "lastName": "Example",
      "isActive": true,
      "roles": [
        {
          "id": "role-456",
          "name": "User",
          "description": "Standard user role"
        }
      ],
      "allPermissions": ["users.read"]
    },
    "permissions": ["users.read"]
  }
}</code></pre>
                    </div>
                </div>

                <h3>POST /api/auth/social-login</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Autenticar via provedor social (Auth0)</p>
                    <p class="text-sm text-gray-600">Usado para Google, Facebook, GitHub via Auth0</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 my-6">
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì§ Request (SocialLoginCommand)</h4>
                        <pre><code class="language-json">{
  "provider": "google",
  "accessToken": "auth0_access_token_from_frontend"
}</code></pre>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì• Response (AuthenticationResult)</h4>
                        <pre><code class="language-json">{
  "isSuccess": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IlJlZnJlc2gi...",
    "expiresAt": "2024-03-15T14:30:00Z",
    "user": {
      "id": "456e7890-e89b-12d3-a456-426614174001",
      "email": "user@gmail.com",
      "firstName": "Google",
      "lastName": "User",
      "auth0UserId": "google-oauth2|123456789"
    }
  }
}</code></pre>
                    </div>
                </div>

                <h3>POST /api/auth/refresh</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Renovar JWT token usando refresh token</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 my-6">
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì§ Request (RefreshTokenCommand)</h4>
                        <pre><code class="language-json">{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IlJlZnJlc2gi..."
}</code></pre>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì• Response</h4>
                        <pre><code class="language-json">{
  "isSuccess": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IlJlZnJlc2gi...",
    "expiresAt": "2024-03-15T15:30:00Z"
  }
}</code></pre>
                    </div>
                </div>

                <h3>POST /api/auth/logout</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Logout e revoga√ß√£o de token</p>
                    <p class="text-sm text-gray-600">üîí Requer: <code>Authorization: Bearer {token}</code></p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 my-6">
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì§ Request (LogoutCommand)</h4>
                        <pre><code class="language-json">{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}</code></pre>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì• Response</h4>
                        <pre><code class="language-json">{
  "isSuccess": true,
  "message": "Logout successful"
}</code></pre>
                    </div>
                </div>

                <h3>GET /api/auth/me</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Obter informa√ß√µes do usu√°rio atual</p>
                    <p class="text-sm text-gray-600">üîí Requer: <code>Authorization: Bearer {token}</code></p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 my-6">
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì§ Headers</h4>
                        <pre><code class="language-json">{
  "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}</code></pre>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì• Response</h4>
                        <pre><code class="language-json">{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "email": "user@example.com",
  "roles": ["User", "Manager"],
  "permissions": ["users.read", "users.create"]
}</code></pre>
                    </div>
                </div>

                <h3>GET /api/auth/validate</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Validar token atual</p>
                    <p class="text-sm text-gray-600">üîí Requer: <code>Authorization: Bearer {token}</code></p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 my-6">
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì§ Headers</h4>
                        <pre><code class="language-json">{
  "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}</code></pre>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì• Response</h4>
                        <pre><code class="language-json">{
  "valid": true,
  "message": "Token is valid"
}</code></pre>
                    </div>
                </div>

                <h2>üë• UsersController</h2>
                <p>Controller para gerenciamento de usu√°rios. <span class="text-red-600">Todos endpoints requerem autentica√ß√£o</span></p>

                <h3>GET /api/users</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Listar usu√°rios com pagina√ß√£o</p>
                    <p class="text-sm text-gray-600">üîí Requer permiss√£o: <code>users.read</code></p>
                </div>

                <div class="bg-blue-50 p-3 rounded mb-4">
                    <p class="text-sm text-blue-700"><strong>URL:</strong> <code>GET /api/users?page=1&size=10&search=user</code></p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 my-6">
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì§ Headers + Query</h4>
                        <pre><code class="language-json">Headers:
{
  "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}

Query Parameters (GetUsersQuery):
{
  "page": 1,
  "size": 10,
  "search": "user",
  "sortBy": "email",
  "sortDirection": "asc"
}</code></pre>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì• Response (PagedResult&lt;UserDto&gt;)</h4>
                        <pre><code class="language-json">{
  "isSuccess": true,
  "data": {
    "items": [
      {
        "id": "123e4567-e89b-12d3-a456-426614174000",
        "email": "user@example.com",
        "firstName": "User",
        "lastName": "Example",
        "auth0UserId": "auth0|123456",
        "isActive": true,
        "lastLoginAt": "2024-03-15T10:30:00Z",
        "profilePictureUrl": null,
        "phoneNumber": "+5511999999999",
        "createdAt": "2024-01-15T08:00:00Z",
        "updatedAt": "2024-03-15T09:20:00Z",
        "roles": [
          {
            "id": "role-456",
            "name": "User",
            "description": "Standard user",
            "isSystemRole": true,
            "createdAt": "2024-01-01T00:00:00Z",
            "permissions": []
          }
        ],
        "directPermissions": [],
        "allPermissions": ["users.read"]
      }
    ],
    "totalCount": 50,
    "page": 1,
    "size": 10,
    "totalPages": 5
  }
}</code></pre>
                    </div>
                </div>

                <h3>GET /api/users/{id}</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Obter usu√°rio por ID</p>
                    <p class="text-sm text-gray-600">üîí Requer permiss√£o: <code>users.read</code></p>
                </div>

                <div class="bg-blue-50 p-3 rounded mb-4">
                    <p class="text-sm text-blue-700"><strong>URL:</strong> <code>GET /api/users/123e4567-e89b-12d3-a456-426614174000</code></p>
                </div>

                <h3>POST /api/users</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Criar novo usu√°rio</p>
                    <p class="text-sm text-gray-600">üîí Requer permiss√£o: <code>users.create</code></p>
                </div>

                <h3>PUT /api/users/{id}</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Atualizar usu√°rio existente</p>
                    <p class="text-sm text-gray-600">üîí Requer permiss√£o: <code>users.update</code></p>
                </div>

                <h3>DELETE /api/users/{id}</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Remover usu√°rio</p>
                    <p class="text-sm text-gray-600">üîí Requer permiss√£o: <code>users.delete</code></p>
                </div>

                <h2>‚öôÔ∏è RolesController</h2>
                <p>Controller para gerenciamento de roles. <span class="text-red-600">Todos endpoints requerem autentica√ß√£o</span></p>

                <h3>GET /api/roles</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Listar todas as roles</p>
                    <p class="text-sm text-gray-600">üîí Requer permiss√£o: <code>roles.read</code></p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 my-6">
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì§ Headers + Query</h4>
                        <pre><code class="language-json">Headers:
{
  "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}

Query Parameters:
{
  "includeSystemRoles": true
}</code></pre>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">üì• Response (List&lt;RoleDto&gt;)</h4>
                        <pre><code class="language-json">{
  "isSuccess": true,
  "data": [
    {
      "id": "role-user",
      "name": "User",
      "description": "Standard user role",
      "isSystemRole": true,
      "createdAt": "2024-01-01T00:00:00Z",
      "permissions": [
        {
          "id": "perm-users-read",
          "name": "users.read",
          "description": "Read users",
          "category": "users",
          "isSystemPermission": true,
          "createdAt": "2024-01-01T00:00:00Z"
        }
      ]
    },
    {
      "id": "role-admin",
      "name": "Admin",
      "description": "Administrator role",
      "isSystemRole": true,
      "createdAt": "2024-01-01T00:00:00Z",
      "permissions": []
    }
  ]
}</code></pre>
                    </div>
                </div>

                <h3>GET /api/roles/{id}</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Obter role por ID</p>
                    <p class="text-sm text-gray-600">üîí Requer permiss√£o: <code>roles.read</code></p>
                </div>

                <h3>GET /api/roles/by-name/{name}</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Obter role por nome</p>
                    <p class="text-sm text-gray-600">üîí Requer permiss√£o: <code>roles.read</code></p>
                </div>

                <div class="bg-blue-50 p-3 rounded mb-4">
                    <p class="text-sm text-blue-700"><strong>URL:</strong> <code>GET /api/roles/by-name/Admin</code></p>
                </div>

                <h3>POST /api/roles</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Criar nova role</p>
                    <p class="text-sm text-gray-600">üîí Requer permiss√£o: <code>roles.create</code></p>
                </div>

                <h2>üîí PermissionsController</h2>
                <p>Controller para gerenciamento de permiss√µes.</p>

                <h3>GET /api/permissions</h3>
                <div class="bg-gray-50 p-4 rounded-lg my-4">
                    <p class="font-semibold text-gray-700">Listar todas as permiss√µes</p>
                    <p class="text-sm text-gray-600">üîí Requer permiss√£o: <code>permissions.read</code></p>
                </div>

                <h2>üîß Middleware Implementado</h2>
                <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-500 my-6">
                    <h3 class="text-yellow-800 font-semibold">üõ°Ô∏è AppIdAuthorizationMiddleware</h3>
                    <p class="text-yellow-700">Middleware que valida se o usu√°rio autenticado est√° vinculado ao AppId da requisi√ß√£o.</p>
                    <ul class="text-sm text-yellow-700 mt-2">
                        <li>‚Ä¢ Extrai AppId do header <code>X-App-Id</code> ou claim JWT</li>
                        <li>‚Ä¢ Valida se usu√°rio tem acesso ao AppId especificado</li>
                        <li>‚Ä¢ Retorna 403 se AppId n√£o informado ou inv√°lido</li>
                    </ul>
                </div>

                <h2>üìã Valida√ß√£o de Permiss√µes</h2>
                <div class="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-500 my-6">
                    <h3 class="text-purple-800 font-semibold">üéØ RequirePermission Attribute</h3>
                    <p class="text-purple-700">Atributo usado nos controllers para validar permiss√µes espec√≠ficas.</p>
                    <pre class="bg-gray-800 text-green-400 p-3 rounded text-sm mt-2"><code>[RequirePermission("users.read")]
public async Task&lt;ActionResult&gt; GetUsers() { ... }</code></pre>
                </div>

                <h2>üß™ Exemplos de Teste com cURL</h2>

                <h3>Login</h3>
                <pre><code class="language-bash">curl -X POST "https://api.yourapp.com/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "UserPassword123!"
  }'</code></pre>

                <h3>Listar Usu√°rios (com token)</h3>
                <pre><code class="language-bash">curl -X GET "https://api.yourapp.com/api/users?page=1&size=10" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json"</code></pre>

                <h3>Social Login (Auth0)</h3>
                <pre><code class="language-bash">curl -X POST "https://api.yourapp.com/api/auth/social-login" \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "google",
    "accessToken": "auth0_access_token_from_frontend"
  }'</code></pre>

                <div class="bg-green-50 p-6 rounded-lg border border-green-200 my-8">
                    <h3 class="font-semibold text-green-800 mb-4">‚úÖ Controllers Implementados</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-green-700">
                        <div>
                            <h4 class="font-semibold mb-2">üîê AuthController:</h4>
                            <ul class="space-y-1">
                                <li>‚Ä¢ Login (email/password)</li>
                                <li>‚Ä¢ Social Login (Auth0)</li>
                                <li>‚Ä¢ Token Refresh</li>
                                <li>‚Ä¢ Logout</li>
                                <li>‚Ä¢ Get Current User</li>
                                <li>‚Ä¢ Validate Token</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">üë• UsersController:</h4>
                            <ul class="space-y-1">
                                <li>‚Ä¢ GET /users (list)</li>
                                <li>‚Ä¢ GET /users/{id}</li>
                                <li>‚Ä¢ POST /users (create)</li>
                                <li>‚Ä¢ PUT /users/{id}</li>
                                <li>‚Ä¢ DELETE /users/{id}</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">‚öôÔ∏è RolesController:</h4>
                            <ul class="space-y-1">
                                <li>‚Ä¢ GET /roles (list)</li>
                                <li>‚Ä¢ GET /roles/{id}</li>
                                <li>‚Ä¢ GET /roles/by-name/{name}</li>
                                <li>‚Ä¢ POST /roles (create)</li>
                                <li>‚Ä¢ Role management</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-8">                    
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                        <h3 class="font-semibold text-purple-800 mb-2">üè† Home</h3>
                        <p class="text-sm text-purple-600 mb-3">Voltar √† documenta√ß√£o principal</p>
                        <a href="index.html" class="text-purple-600 text-sm font-medium hover:underline">
                            Voltar ao In√≠cio ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>hljs.highlightAll();</script>
</body>
</html>
