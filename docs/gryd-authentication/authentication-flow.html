<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluxo de Autentica√ß√£o - GrydAuth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .code-block {
            background-color: #1e293b;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        .flow-box {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
        }
        .frontend-box { border-color: #3b82f6; background-color: #eff6ff; }
        .auth0-box { border-color: #f59e0b; background-color: #fffbeb; }
        .grydauth-box { border-color: #10b981; background-color: #ecfdf5; }
        .arrow {
            font-size: 1.5rem;
            text-align: center;
            color: #6b7280;
            margin: 0.5rem 0;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-6xl mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-8">üîê Fluxo de Autentica√ß√£o GrydAuth</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <p class="text-lg text-gray-700 mb-4">
                Este documento apresenta o fluxo completo de autentica√ß√£o do GrydAuthenticationFramework, 
                incluindo a estrat√©gia h√≠brida de refresh tokens para m√°xima seguran√ßa e experi√™ncia do usu√°rio.
                Baseado na an√°lise do c√≥digo real, voc√™ encontrar√° como integrar um frontend 
                com o GrydAuth para autentica√ß√£o, autoriza√ß√£o e gest√£o de tokens.
            </p>
            
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mt-4">
                <h3 class="font-semibold text-blue-800 mb-2">üÜï Novidades da Implementa√ß√£o</h3>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li>‚úÖ <strong>Refresh Token Seguro:</strong> Implementa√ß√£o completa com rota√ß√£o autom√°tica</li>
                    <li>‚úÖ <strong>Estrat√©gia H√≠brida:</strong> Renova√ß√£o preventiva + reativa para melhor UX</li>
                    <li>‚úÖ <strong>Rastreamento de Seguran√ßa:</strong> IP tracking, device fingerprinting e audit trail</li>
                    <li>‚úÖ <strong>Revoga√ß√£o Granular:</strong> Revoga√ß√£o individual ou em massa de tokens</li>
                </ul>
            </div>
        </div>

        <!-- Diagrama de Fluxo -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üìä Diagrama do Fluxo de Integra√ß√£o</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Frontend -->
                <div class="frontend-box">
                    <h3 class="font-bold text-blue-800 mb-2">üíª Frontend</h3>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ Formul√°rio de Login</li>
                        <li>‚Ä¢ Bot√µes Social Login</li>
                        <li>‚Ä¢ Headers X-App-Id</li>
                        <li>‚Ä¢ Gerenciamento Token</li>
                    </ul>
                </div>

                <!-- Auth0 -->
                <div class="auth0-box">
                    <h3 class="font-bold text-amber-800 mb-2">üîê Auth0</h3>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ Valida√ß√£o Credenciais</li>
                        <li>‚Ä¢ Social Providers</li>
                        <li>‚Ä¢ User Profile</li>
                        <li>‚Ä¢ OAuth Tokens</li>
                    </ul>
                </div>

                <!-- GrydAuth -->
                <div class="grydauth-box">
                    <h3 class="font-bold text-green-800 mb-2">üõ°Ô∏è GrydAuth</h3>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ User Management</li>
                        <li>‚Ä¢ JWT Generation</li>
                        <li>‚Ä¢ Role/Permission</li>
                        <li>‚Ä¢ AppId Validation</li>
                    </ul>
                </div>
            </div>

            <div class="mt-6">
                <h4 class="font-bold text-gray-800 mb-4">Fluxo de Comunica√ß√£o:</h4>
                
                <div class="space-y-2">
                    <div class="frontend-box">
                        <span class="font-semibold">1. Frontend</span> ‚Üí Obt√©m chave p√∫blica (GET /api/auth/public-key)
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="frontend-box">
                        <span class="font-semibold">2. Frontend</span> ‚Üí Criptografa senha com chave p√∫blica RSA
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="grydauth-box">
                        <span class="font-semibold">3. GrydAuth</span> ‚Üí Recebe senha criptografada (POST /api/auth/login)
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="grydauth-box">
                        <span class="font-semibold">4. GrydAuth</span> ‚Üí Descriptografa senha com chave privada
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="auth0-box">
                        <span class="font-semibold">5. Auth0</span> ‚Üí GrydAuth valida credenciais no Auth0
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="grydauth-box">
                        <span class="font-semibold">6. GrydAuth</span> ‚Üí Busca/cria usu√°rio local, gera JWT com roles/permissions
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="frontend-box">
                        <span class="font-semibold">7. Frontend</span> ‚Üí Recebe JWT e dados do usu√°rio, armazena token
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="frontend-box">
                        <span class="font-semibold">8. Requisi√ß√µes</span> ‚Üí Frontend usa JWT + Header X-App-Id para APIs protegidas
                    </div>
                </div>
            </div>
        </div>

        <!-- Chave P√∫blica -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üîë Obten√ß√£o da Chave P√∫blica</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üì§ Requisi√ß√£o</h3>
                    <p class="text-sm text-gray-600 mb-2"><strong>Endpoint:</strong> <code class="bg-gray-100 px-2 py-1 rounded">GET /api/auth/public-key</code></p>
                    <p class="text-sm text-gray-600 mb-2"><strong>Headers:</strong></p>
                    <div class="code-block mb-3">
<pre>X-App-Id: seu-app-id-aqui</pre>
                    </div>
                    <p class="text-sm text-gray-600 mb-2"><strong>Sem Body</strong></p>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üì• Resposta</h3>
                    <div class="code-block">
<pre>{
  "publicKey": "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0K...",
  "keyId": "a7b3c9d2",
  "algorithm": "RSA-OAEP-SHA256",
  "keySize": 2048,
  "usage": "Encrypt passwords before sending to login endpoint"
}</pre>
                    </div>
                </div>
            </div>

            <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <h4 class="font-semibold text-blue-800 mb-2">üîê Seguran√ßa da Chave P√∫blica:</h4>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li>‚Ä¢ <strong>Chave p√∫blica pode ser interceptada:</strong> Isso √© normal e esperado</li>
                    <li>‚Ä¢ <strong>N√£o compromete seguran√ßa:</strong> Apenas permite criptografar, n√£o descriptografar</li>
                    <li>‚Ä¢ <strong>Rota√ß√£o autom√°tica:</strong> Chaves s√£o rotacionadas periodicamente</li>
                    <li>‚Ä¢ <strong>KeyId para refer√™ncia:</strong> Identifica qual chave foi usada</li>
                </ul>
            </div>
        </div>

        <!-- Login Tradicional -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üîë Login Tradicional (Email/Senha)</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üì§ Requisi√ß√£o</h3>
                    <p class="text-sm text-gray-600 mb-2"><strong>Endpoint:</strong> <code class="bg-gray-100 px-2 py-1 rounded">POST /api/auth/login</code></p>
                    <p class="text-sm text-gray-600 mb-2"><strong>Headers:</strong></p>
                    <div class="code-block mb-3">
<pre>Content-Type: application/json
X-App-Id: seu-app-id-aqui</pre>
                    </div>
                    <p class="text-sm text-gray-600 mb-2"><strong>Body (Vers√£o Criptografada - Recomendada):</strong></p>
                    <div class="code-block">
<pre>{
  "email": "usuario@exemplo.com",
  "password": "gT7$kL9@mX4pR8vN2sH6jD1qW5...", // Senha criptografada com RSA
  "isPasswordEncrypted": true
}</pre>
                    </div>
                    
                    <p class="text-sm text-gray-600 mb-2 mt-4"><strong>Body (Vers√£o Texto Plano - N√£o Recomendada):</strong></p>
                    <div class="code-block">
<pre>{
  "email": "usuario@exemplo.com",
  "password": "senha123", // ‚ö†Ô∏è Texto plano - menos seguro
  "isPasswordEncrypted": false
}</pre>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üì• Resposta (Sucesso)</h3>
                    <div class="code-block">
<pre>{
  "isSuccess": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "guid-refresh-token",
    "expiresAt": "2025-08-26T15:30:00Z",
    "user": {
      "id": "user-guid",
      "email": "usuario@exemplo.com",
      "firstName": "Jo√£o",
      "lastName": "Silva",
      "isActive": true,
      "lastLoginAt": "2025-08-26T12:30:00Z",
      "roles": ["User"],
      "allPermissions": ["read:users", "create:posts"]
    },
    "permissions": ["read:users", "create:posts"]
  },
  "errors": []
}</pre>
                    </div>
                </div>
            </div>

            <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <h4 class="font-semibold text-yellow-800 mb-2">‚ö†Ô∏è Valida√ß√µes Importantes:</h4>
                <ul class="text-sm text-yellow-700 space-y-1">
                    <li>‚Ä¢ <strong>Email obrigat√≥rio:</strong> Deve ser um email v√°lido</li>
                    <li>‚Ä¢ <strong>Password obrigat√≥rio:</strong> Texto plano (min 6 chars) OU base64 v√°lido se criptografado</li>
                    <li>‚Ä¢ <strong>IsPasswordEncrypted:</strong> true para senha criptografada, false para texto plano</li>
                    <li>‚Ä¢ <strong>X-App-Id obrigat√≥rio:</strong> Header necess√°rio para autoriza√ß√£o</li>
                    <li>‚Ä¢ <strong>Usu√°rio deve existir:</strong> Precisa estar criado no GrydAuth local</li>
                    <li>‚Ä¢ <strong>Usu√°rio ativo:</strong> IsActive deve ser true</li>
                    <li>‚Ä¢ <strong>Chave p√∫blica:</strong> Obtenha sempre a mais recente antes de criptografar</li>
                </ul>
            </div>
        </div>

        <!-- Social Login -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üåê Social Login</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üì§ Requisi√ß√£o</h3>
                    <p class="text-sm text-gray-600 mb-2"><strong>Endpoint:</strong> <code class="bg-gray-100 px-2 py-1 rounded">POST /api/auth/social-login</code></p>
                    <p class="text-sm text-gray-600 mb-2"><strong>Headers:</strong></p>
                    <div class="code-block mb-3">
<pre>Content-Type: application/json
X-App-Id: seu-app-id-aqui</pre>
                    </div>
                    <p class="text-sm text-gray-600 mb-2"><strong>Body:</strong></p>
                    <div class="code-block">
<pre>{
  "provider": "google",
  "accessToken": "google-access-token-here"
}</pre>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üì• Resposta (Sucesso)</h3>
                    <div class="code-block">
<pre>{
  "isSuccess": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "guid-refresh-token",
    "expiresAt": "2025-08-26T15:30:00Z",
    "user": {
      "id": "user-guid",
      "email": "usuario@gmail.com",
      "firstName": "Jo√£o",
      "lastName": "Silva",
      "isActive": true,
      "lastLoginAt": "2025-08-26T12:30:00Z",
      "auth0UserId": "google|123456789"
    },
    "permissions": ["read:users"]
  },
  "errors": []
}</pre>
                    </div>
                </div>
            </div>

            <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <h4 class="font-semibold text-blue-800 mb-2">üí° Comportamento do Social Login:</h4>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li>‚Ä¢ <strong>Usu√°rio novo:</strong> Cria automaticamente no GrydAuth com role "User"</li>
                    <li>‚Ä¢ <strong>Usu√°rio existente:</strong> Atualiza Auth0UserId se necess√°rio</li>
                    <li>‚Ä¢ <strong>Providers suportados:</strong> Depende da configura√ß√£o do Auth0</li>
                    <li>‚Ä¢ <strong>Access Token:</strong> Obtido do provider social via frontend</li>
                </ul>
            </div>
        </div>

        <!-- Usando o Token -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üé´ Usando o JWT Token</h2>
            
            <div class="space-y-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üîç Validar Token</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <p class="text-sm text-gray-600 mb-2"><strong>Endpoint:</strong> <code class="bg-gray-100 px-2 py-1 rounded">GET /api/auth/validate</code></p>
                            <p class="text-sm text-gray-600 mb-2"><strong>Headers:</strong></p>
                            <div class="code-block">
<pre>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
X-App-Id: seu-app-id-aqui</pre>
                            </div>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 mb-2"><strong>Resposta:</strong></p>
                            <div class="code-block">
<pre>{
  "valid": true,
  "message": "Token is valid"
}</pre>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üë§ Obter Dados do Usu√°rio</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <p class="text-sm text-gray-600 mb-2"><strong>Endpoint:</strong> <code class="bg-gray-100 px-2 py-1 rounded">GET /api/auth/me</code></p>
                            <p class="text-sm text-gray-600 mb-2"><strong>Headers:</strong></p>
                            <div class="code-block">
<pre>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
X-App-Id: seu-app-id-aqui</pre>
                            </div>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 mb-2"><strong>Resposta:</strong></p>
                            <div class="code-block">
<pre>{
  "id": "user-guid",
  "email": "usuario@exemplo.com",
  "roles": ["User", "Admin"],
  "permissions": ["read:users", "write:posts"]
}</pre>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üîÑ Refresh Token</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <p class="text-sm text-gray-600 mb-2"><strong>Endpoint:</strong> <code class="bg-gray-100 px-2 py-1 rounded">POST /api/auth/refresh</code></p>
                            <p class="text-sm text-gray-600 mb-2"><strong>Body:</strong></p>
                            <div class="code-block">
<pre>{
  "refreshToken": "base64-secure-token-here"
}</pre>
                            </div>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 mb-2"><strong>Resposta:</strong></p>
                            <div class="code-block">
<pre>{
  "isSuccess": true,
  "data": {
    "token": "new-jwt-token",
    "refreshToken": "new-rotated-refresh-token",
    "expiresAt": "2025-08-26T16:30:00Z",
    "user": { /* dados completos do usu√°rio */ },
    "permissions": ["read:users", "write:posts"]
  }
}</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estrat√©gia de Refresh Tokens -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üîÑ Gest√£o de Refresh Tokens - Estrat√©gia H√≠brida</h2>
            
            <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6">
                <h3 class="font-semibold text-green-800 mb-2">‚úÖ Estrat√©gia Implementada</h3>
                <p class="text-sm text-green-700">
                    O GrydAuth implementa uma <strong>estrat√©gia h√≠brida</strong> que combina renova√ß√£o preventiva 
                    (antes da expira√ß√£o) com tratamento reativo (quando 401 √© recebido) para garantir a melhor 
                    experi√™ncia do usu√°rio com m√°xima seguran√ßa. O framework oferece <strong>duas estrat√©gias configur√°veis</strong> 
                    para atender diferentes necessidades de aplica√ß√£o.
                </p>
            </div>

            <!-- Estrat√©gias Configur√°veis -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
                <h3 class="font-semibold text-blue-800 mb-4">‚öôÔ∏è Estrat√©gias de Armazenamento Configur√°veis</h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-4 rounded-lg border border-blue-200">
                        <h4 class="font-semibold text-blue-700 mb-2 flex items-center">
                            üöÄ <span class="ml-2">Stateless (Padr√£o)</span>
                        </h4>
                        <p class="text-sm text-gray-700 mb-3">
                            Refresh tokens s√£o <strong>JWT v√°lidos</strong> validados apenas por assinatura. 
                            Sem persist√™ncia no banco de dados.
                        </p>
                        <div class="space-y-1 text-sm">
                            <div class="text-green-600">‚úì Performance m√°xima</div>
                            <div class="text-green-600">‚úì Escalabilidade infinita</div>
                            <div class="text-green-600">‚úì Zero queries extras</div>
                            <div class="text-red-600">‚úó N√£o revoga tokens individuais</div>
                        </div>
                        <div class="mt-3 p-2 bg-gray-100 rounded text-xs">
                            <strong>Ideal para:</strong> APIs alta performance, microservi√ßos, MVPs
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg border border-green-200">
                        <h4 class="font-semibold text-green-700 mb-2 flex items-center">
                            üíæ <span class="ml-2">Database (Enterprise)</span>
                        </h4>
                        <p class="text-sm text-gray-700 mb-3">
                            Refresh tokens s√£o armazenados no banco com <strong>controle total</strong> 
                            sobre revoga√ß√£o e auditoria.
                        </p>
                        <div class="space-y-1 text-sm">
                            <div class="text-green-600">‚úì Revoga√ß√£o instant√¢nea</div>
                            <div class="text-green-600">‚úì Auditoria completa</div>
                            <div class="text-green-600">‚úì Controle de sess√µes</div>
                            <div class="text-yellow-600">‚ö† Queries extras</div>
                        </div>
                        <div class="mt-3 p-2 bg-gray-100 rounded text-xs">
                            <strong>Ideal para:</strong> Enterprise, compliance, seguran√ßa cr√≠tica
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded">
                    <h5 class="font-semibold text-yellow-800 mb-2">üîß Como Configurar</h5>
                    <div class="text-sm text-yellow-700">
                        <p class="mb-2">Configure a estrat√©gia no <code>appsettings.json</code>:</p>
                        <div class="code-block text-xs">
<pre>{
  "GrydAuth": {
    "RefreshToken": {
      "Strategy": "Stateless",  // ou "Database"
      "ExpirationDays": 7,
      "TrackIpAddresses": true
    }
  }
}</pre>
                        </div>
                        <p class="mt-2"><strong>Migra√ß√£o:</strong> Apenas necess√°ria se usar "Database". Frontend funciona igual para ambas!</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-800">üõ°Ô∏è Caracter√≠sticas de Seguran√ßa</h3>
                    <ul class="text-sm text-gray-700 space-y-2">
                        <li class="flex items-start">
                            <span class="text-green-600 mr-2">‚úì</span>
                            <span><strong>Rota√ß√£o Autom√°tica:</strong> Cada refresh gera um novo token (ambas estrat√©gias)</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-600 mr-2">üìä</span>
                            <span><strong>Rastreamento de IP:</strong> Dispon√≠vel nas duas estrat√©gias (Database = persistido, Stateless = no JWT)</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-600 mr-2">üìä</span>
                            <span><strong>Device Fingerprinting:</strong> User-Agent salvo (Database = banco, Stateless = claim JWT)</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-600 mr-2">‚úì</span>
                            <span><strong>Expira√ß√£o Configur√°vel:</strong> Padr√£o de 7 dias, customiz√°vel via appsettings</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-600 mr-2">üè¢</span>
                            <span><strong>Revoga√ß√£o Granular:</strong> Individual ou em massa (apenas Database strategy)</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-600 mr-2">üè¢</span>
                            <span><strong>Auditoria Completa:</strong> Log de uso e padr√µes (apenas Database strategy)</span>
                        </li>
                    </ul>
                    <div class="mt-3 text-xs text-gray-500">
                        <span class="text-green-600">‚úì</span> = Todas estrat√©gias | 
                        <span class="text-blue-600">üìä</span> = Funciona diferente | 
                        <span class="text-orange-600">üè¢</span> = Apenas Database
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-800">‚ö° Caracter√≠sticas de UX</h3>
                    <ul class="text-sm text-gray-700 space-y-2">
                        <li class="flex items-start">
                            <span class="text-blue-600 mr-2">‚úì</span>
                            <span><strong>Renova√ß√£o Transparente:</strong> Usu√°rio n√£o percebe a troca</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-600 mr-2">‚úì</span>
                            <span><strong>Verifica√ß√£o Preventiva:</strong> Renova 5 min antes de expirar</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-600 mr-2">‚úì</span>
                            <span><strong>Fallback Reativo:</strong> Se preventiva falhar, tenta no 401</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-600 mr-2">‚úì</span>
                            <span><strong>Fila de Requisi√ß√µes:</strong> Enfileira calls durante refresh</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-600 mr-2">‚úì</span>
                            <span><strong>Cleanup Autom√°tico:</strong> Remove tokens expirados</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Fluxo Detalhado -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üîÑ Fluxo de Refresh Token</h3>
                
                <div class="space-y-3">
                    <div class="flex items-center space-x-4">
                        <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold">1</div>
                        <div>
                            <strong>Login Inicial:</strong> User recebe JWT (30 min) + RefreshToken (7 dias)
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold">2</div>
                        <div>
                            <strong>Monitoramento:</strong> Frontend verifica expira√ß√£o a cada 1 minuto
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold">3</div>
                        <div>
                            <strong>Refresh Preventivo:</strong> 5 min antes de expirar, chama <code>/api/auth/refresh</code>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold">4</div>
                        <div>
                            <strong>Rota√ß√£o:</strong> Backend revoga token antigo e gera novo par JWT+RefreshToken
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="w-8 h-8 bg-yellow-500 text-white rounded-full flex items-center justify-center text-sm font-bold">5</div>
                        <div>
                            <strong>Fallback:</strong> Se preventivo falhar, interceptor trata 401 e tenta refresh
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center text-sm font-bold">6</div>
                        <div>
                            <strong>Falha Total:</strong> Se refresh falhar, redireciona para login
                        </div>
                    </div>
                </div>
            </div>

            <!-- C√≥digos de Implementa√ß√£o -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-semibold text-gray-800 mb-3">üì§ Requisi√ß√£o de Refresh</h4>
                    <div class="code-block">
<pre>POST /api/auth/refresh
Content-Type: application/json

{
  "refreshToken": "base64-secure-token-here"
}</pre>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-semibold text-gray-800 mb-3">üì• Resposta de Sucesso</h4>
                    <div class="code-block">
<pre>{
  "isSuccess": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "new-rotated-base64-token",
    "expiresAt": "2025-08-26T16:00:00Z",
    "user": {
      "id": "user-guid",
      "email": "user@example.com",
      "firstName": "Jo√£o",
      "lastName": "Silva",
      // ... dados completos
    },
    "permissions": ["read:users", "create:posts"]
  },
  "errors": []
}</pre>
                    </div>
                </div>
            </div>

            <div class="mt-6 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                <h4 class="font-semibold text-amber-800 mb-2">‚ö° Configura√ß√µes Recomendadas</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-amber-700">
                    <div>
                        <strong>JWT Token:</strong>
                        <ul class="ml-4 list-disc">
                            <li>Expira√ß√£o: 15-60 minutos</li>
                            <li>Refresh Threshold: 5 minutos antes</li>
                            <li>Check Interval: 1 minuto</li>
                        </ul>
                    </div>
                    <div>
                        <strong>Refresh Token:</strong>
                        <ul class="ml-4 list-disc">
                            <li>Expira√ß√£o: 7 dias (configur√°vel)</li>
                            <li>Rota√ß√£o: A cada uso</li>
                            <li>Cleanup: Di√°rio (apenas Database)</li>
                        </ul>
                    </div>
                    <div>
                        <strong>Estrat√©gia:</strong>
                        <ul class="ml-4 list-disc">
                            <li>Padr√£o: "Stateless"</li>
                            <li>Enterprise: "Database"</li>
                            <li>Configur√°vel via appsettings.json</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logout -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üö™ Logout</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üì§ Requisi√ß√£o</h3>
                    <p class="text-sm text-gray-600 mb-2"><strong>Endpoint:</strong> <code class="bg-gray-100 px-2 py-1 rounded">POST /api/auth/logout</code></p>
                    <p class="text-sm text-gray-600 mb-2"><strong>Headers:</strong></p>
                    <div class="code-block mb-3">
<pre>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json
X-App-Id: seu-app-id-aqui</pre>
                    </div>
                    <p class="text-sm text-gray-600 mb-2"><strong>Body:</strong></p>
                    <div class="code-block">
<pre>{
  "token": "jwt-token-to-revoke"
}</pre>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üì• Resposta</h3>
                    <div class="code-block">
<pre>{
  "isSuccess": true,
  "errors": []
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configura√ß√£o Backend -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">‚öôÔ∏è Configura√ß√£o Backend - Estrat√©gias</h2>
            
            <div class="space-y-6">
                <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h3 class="font-semibold text-blue-800 mb-3">üìã Configura√ß√£o via appsettings.json</h3>
                    <div class="code-block mb-4">
<pre>{
  "GrydAuth": {
    "RefreshToken": {
      "Strategy": "Stateless",        // "Stateless" ou "Database"
      "ExpirationDays": 7,            // Dias at√© expira√ß√£o
      "MaxTokensPerUser": 5,          // M√°ximo por usu√°rio (Database only)
      "TrackIpAddresses": true,       // Rastrear IPs
      "TrackDeviceInfo": true,        // Rastrear dispositivos
      "CleanupIntervalHours": 24      // Limpeza autom√°tica (Database only)
    },
    "Jwt": {
      "ExpirationMinutes": 30,        // JWT expira em 30 min
      "RefreshBeforeExpirationMinutes": 5  // Renova 5 min antes
    }
  }
}</pre>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-3">üöÄ Setup Stateless (Recomendado)</h4>
                        <ol class="text-sm text-green-700 space-y-2 list-decimal list-inside">
                            <li>Configure <code>"Strategy": "Stateless"</code></li>
                            <li>Adicione <code>services.AddGrydAuthentication(Configuration);</code></li>
                            <li>Restart da aplica√ß√£o</li>
                            <li>‚úÖ <strong>Pronto!</strong> Sem migra√ß√µes necess√°rias</li>
                        </ol>
                        <div class="mt-3 p-2 bg-white border border-green-300 rounded text-xs">
                            <strong>Vantagem:</strong> Zero configura√ß√£o adicional, performance m√°xima
                        </div>
                    </div>
                    
                    <div class="p-4 bg-orange-50 border border-orange-200 rounded-lg">
                        <h4 class="font-semibold text-orange-800 mb-3">üíæ Setup Database (Enterprise)</h4>
                        <ol class="text-sm text-orange-700 space-y-2 list-decimal list-inside">
                            <li>Configure <code>"Strategy": "Database"</code></li>
                            <li>Adicione <code>services.AddGrydAuthentication(Configuration);</code></li>
                            <li>Execute migra√ß√£o: <code>dotnet ef migrations add RefreshTokens</code></li>
                            <li>Atualize banco: <code>dotnet ef database update</code></li>
                            <li>‚úÖ <strong>Pronto!</strong> Com controle total</li>
                        </ol>
                        <div class="mt-3 p-2 bg-white border border-orange-300 rounded text-xs">
                            <strong>Vantagem:</strong> Auditoria, revoga√ß√£o granular, controle de sess√µes
                        </div>
                    </div>
                </div>

                <div class="p-4 bg-purple-50 border border-purple-200 rounded-lg">
                    <h4 class="font-semibold text-purple-800 mb-3">üîÑ Migra√ß√£o Entre Estrat√©gias</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-purple-700">
                        <div>
                            <strong>Stateless ‚Üí Database:</strong>
                            <ol class="list-decimal list-inside mt-1 space-y-1">
                                <li>Altere Strategy para "Database"</li>
                                <li>Execute migra√ß√£o EF</li>
                                <li>Restart aplica√ß√£o</li>
                                <li>Usu√°rios fazem novo login</li>
                            </ol>
                        </div>
                        <div>
                            <strong>Database ‚Üí Stateless:</strong>
                            <ol class="list-decimal list-inside mt-1 space-y-1">
                                <li>Altere Strategy para "Stateless"</li>
                                <li>Restart aplica√ß√£o</li>
                                <li>(Opcional) Drop tabela RefreshTokens</li>
                                <li>Performance melhorada!</li>
                            </ol>
                        </div>
                    </div>
                    <div class="mt-3 p-2 bg-white border border-purple-300 rounded text-xs">
                        <strong>Importante:</strong> Frontend funciona igual para ambas - zero mudan√ßas no c√≥digo cliente!
                    </div>
                </div>
            </div>
        </div>

        <!-- Sequ√™ncia de Integra√ß√£o -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üöÄ Sequ√™ncia de Integra√ß√£o Frontend</h2>
            
            <div class="space-y-6">
                <div class="p-4 bg-gray-50 border-l-4 border-blue-500 rounded-r-lg">
                    <h3 class="font-semibold text-blue-800 mb-2">1. Configura√ß√£o Inicial</h3>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>‚Ä¢ Configure a base URL da API GrydAuth</li>
                        <li>‚Ä¢ Defina o App-Id que ser√° usado nas requisi√ß√µes</li>
                        <li>‚Ä¢ Implemente interceptor para adicionar headers automaticamente</li>
                    </ul>
                </div>

                <div class="p-4 bg-gray-50 border-l-4 border-green-500 rounded-r-lg">
                    <h3 class="font-semibold text-green-800 mb-2">2. Tela de Login</h3>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>‚Ä¢ Formul√°rio com email/senha + bot√£o de login tradicional</li>
                        <li>‚Ä¢ Bot√µes para social login (Google, Facebook, etc.)</li>
                        <li>‚Ä¢ Ao clicar login: chame POST /api/auth/login</li>
                        <li>‚Ä¢ Ao clicar social: obtenha access token do provider, depois chame POST /api/auth/social-login</li>
                    </ul>
                </div>

                <div class="p-4 bg-gray-50 border-l-4 border-yellow-500 rounded-r-lg">
                    <h3 class="font-semibold text-yellow-800 mb-2">3. P√≥s-Login</h3>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>‚Ä¢ Armazene o JWT token no localStorage/sessionStorage</li>
                        <li>‚Ä¢ Salve os dados do usu√°rio (id, email, roles, permissions)</li>
                        <li>‚Ä¢ Redirecione para a √°rea autenticada da aplica√ß√£o</li>
                        <li>‚Ä¢ Configure interceptor para incluir token em todas as requisi√ß√µes</li>
                    </ul>
                </div>

                <div class="p-4 bg-gray-50 border-l-4 border-purple-500 rounded-r-lg">
                    <h3 class="font-semibold text-purple-800 mb-2">4. Requisi√ß√µes Autenticadas</h3>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>‚Ä¢ Sempre inclua: Authorization: Bearer [token]</li>
                        <li>‚Ä¢ Sempre inclua: X-App-Id: [seu-app-id]</li>
                        <li>‚Ä¢ Trate erros 401 (token expirado) ‚Üí fazer refresh ou re-login</li>
                        <li>‚Ä¢ Trate erros 403 (sem permiss√£o) ‚Üí mostrar mensagem adequada</li>
                    </ul>
                </div>

                <div class="p-4 bg-gray-50 border-l-4 border-red-500 rounded-r-lg">
                    <h3 class="font-semibold text-red-800 mb-2">5. Gerenciamento de Token (Estrat√©gia H√≠brida)</h3>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>‚Ä¢ <strong>Armazenamento:</strong> localStorage para JWT + RefreshToken</li>
                        <li>‚Ä¢ <strong>Monitoramento:</strong> Timer verifica expira√ß√£o a cada 1 minuto</li>
                        <li>‚Ä¢ <strong>Refresh Preventivo:</strong> Renova 5 min antes de expirar automaticamente</li>
                        <li>‚Ä¢ <strong>Interceptor Reativo:</strong> Intercepta 401, tenta refresh, re-executa requisi√ß√£o</li>
                        <li>‚Ä¢ <strong>Fila de Requisi√ß√µes:</strong> Enfileira chamadas durante refresh em andamento</li>
                        <li>‚Ä¢ <strong>Fallback:</strong> Se refresh falhar, limpa tokens e redireciona para login</li>
                        <li>‚Ä¢ <strong>Eventos:</strong> Dispara eventos customizados para notificar componentes</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Implementa√ß√£o Frontend H√≠brida -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üíª Implementa√ß√£o Frontend - Estrat√©gia H√≠brida</h2>
            
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">üéØ AuthService Completo</h3>
                <div class="code-block">
<pre>class AuthService {
    constructor() {
        this.refreshThreshold = 5 * 60 * 1000; // 5 minutos
        this.checkInterval = 60 * 1000; // 1 minuto
        this.isRefreshing = false;
        this.refreshPromise = null;
        this.failedQueue = [];
        
        this.init();
    }
    
    init() {
        this.startTokenMonitoring();
        this.setupApiInterceptors();
        this.setupEventListeners();
    }
    
    // Monitoramento Preventivo
    startTokenMonitoring() {
        setInterval(() => {
            this.checkTokenStatus();
        }, this.checkInterval);
        
        this.checkTokenStatus(); // Verificar imediatamente
    }
    
    async checkTokenStatus() {
        const tokenData = this.getStoredToken();
        if (this.shouldRefreshToken(tokenData)) {
            await this.refreshTokenSilently();
        }
    }
    
    shouldRefreshToken(tokenData) {
        if (!tokenData?.expiresAt) return false;
        
        const expiryTime = new Date(tokenData.expiresAt).getTime();
        const now = Date.now();
        const timeUntilExpiry = expiryTime - now;
        
        return timeUntilExpiry <= this.refreshThreshold && timeUntilExpiry > 0;
    }
    
    // Estrat√©gia H√≠brida
    async makeAuthenticatedRequest(config) {
        // 1. Verifica√ß√£o preventiva
        const tokenData = this.getStoredToken();
        if (this.shouldRefreshToken(tokenData)) {
            await this.refreshTokenSilently();
        }
        
        try {
            return await this.apiCall(config);
        } catch (error) {
            // 2. Tratamento reativo para 401
            if (error.response?.status === 401) {
                return this.handleUnauthorized(config);
            }
            throw error;
        }
    }
    
    async handleUnauthorized(originalConfig) {
        if (this.isRefreshing) {
            return new Promise((resolve, reject) => {
                this.failedQueue.push({ resolve, reject, config: originalConfig });
            });
        }
        
        try {
            await this.refreshTokenSilently();
            return this.apiCall(originalConfig);
        } catch (error) {
            this.handleAuthFailure();
            throw error;
        }
    }
    
    // Refresh Token Logic
    async refreshTokenSilently() {
        if (this.isRefreshing) {
            return this.refreshPromise;
        }
        
        this.isRefreshing = true;
        this.refreshPromise = this.performRefresh();
        
        try {
            await this.refreshPromise;
            this.processFailedQueue(null);
        } catch (error) {
            this.processFailedQueue(error);
            throw error;
        } finally {
            this.isRefreshing = false;
            this.refreshPromise = null;
        }
    }
    
    async performRefresh() {
        const tokenData = this.getStoredToken();
        if (!tokenData?.refreshToken) {
            throw new Error('No refresh token available');
        }
        
        try {
            const response = await fetch('/api/auth/refresh', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ refreshToken: tokenData.refreshToken })
            });
            
            const data = await response.json();
            
            if (!response.ok || !data.isSuccess) {
                throw new Error(data.message || 'Token refresh failed');
            }
            
            this.storeTokens(data.data);
            this.notifyTokenRefreshed();
            
        } catch (error) {
            console.error('Token refresh failed:', error);
            throw error;
        }
    }
    
    processFailedQueue(error) {
        this.failedQueue.forEach(({ resolve, reject, config }) => {
            if (error) {
                reject(error);
            } else {
                resolve(this.apiCall(config));
            }
        });
        
        this.failedQueue = [];
    }
    
    // Utilit√°rios
    getStoredToken() {
        try {
            return JSON.parse(localStorage.getItem('gryd_auth_token'));
        } catch {
            return null;
        }
    }
    
    storeTokens(authResult) {
        localStorage.setItem('gryd_auth_token', JSON.stringify(authResult));
    }
    
    clearTokens() {
        localStorage.removeItem('gryd_auth_token');
    }
    
    notifyTokenRefreshed() {
        window.dispatchEvent(new CustomEvent('tokenRefreshed', {
            detail: this.getStoredToken()
        }));
    }
    
    handleAuthFailure() {
        this.clearTokens();
        this.showSessionExpiredMessage();
        setTimeout(() => {
            window.location.href = '/login?reason=session_expired';
        }, 2000);
    }
}

// Inst√¢ncia global
const authService = new AuthService();</pre>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">‚öõÔ∏è React Hook</h3>
                    <div class="code-block">
<pre>// useAuth.js
import { useState, useEffect } from 'react';

export const useAuth = () => {
    const [isAuthenticated, setIsAuthenticated] = useState(false);
    const [user, setUser] = useState(null);
    const [loading, setLoading] = useState(true);
    
    useEffect(() => {
        const checkAuth = () => {
            const tokenData = authService.getStoredToken();
            if (tokenData?.token) {
                setIsAuthenticated(true);
                setUser(tokenData.user);
            }
            setLoading(false);
        };
        
        checkAuth();
        
        const handleTokenRefreshed = (event) => {
            setUser(event.detail.user);
        };
        
        const handleAuthFailed = () => {
            setIsAuthenticated(false);
            setUser(null);
        };
        
        window.addEventListener('tokenRefreshed', handleTokenRefreshed);
        window.addEventListener('authenticationFailed', handleAuthFailed);
        
        return () => {
            window.removeEventListener('tokenRefreshed', handleTokenRefreshed);
            window.removeEventListener('authenticationFailed', handleAuthFailed);
        };
    }, []);
    
    return { isAuthenticated, user, loading };
};</pre>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üçÉ Vue Composable</h3>
                    <div class="code-block">
<pre>// useAuth.js
import { ref, onMounted, onUnmounted } from 'vue';

export const useAuth = () => {
    const isAuthenticated = ref(false);
    const user = ref(null);
    const loading = ref(true);
    
    const checkAuth = () => {
        const tokenData = authService.getStoredToken();
        if (tokenData?.token) {
            isAuthenticated.value = true;
            user.value = tokenData.user;
        }
        loading.value = false;
    };
    
    const handleTokenRefreshed = (event) => {
        user.value = event.detail.user;
    };
    
    const handleAuthFailed = () => {
        isAuthenticated.value = false;
        user.value = null;
    };
    
    onMounted(() => {
        checkAuth();
        window.addEventListener('tokenRefreshed', handleTokenRefreshed);
        window.addEventListener('authenticationFailed', handleAuthFailed);
    });
    
    onUnmounted(() => {
        window.removeEventListener('tokenRefreshed', handleTokenRefreshed);
        window.removeEventListener('authenticationFailed', handleAuthFailed);
    });
    
    return { isAuthenticated, user, loading };
};</pre>
                    </div>
                </div>
            </div>
            
            <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                <h4 class="font-semibold text-green-800 mb-2">‚úÖ Vantagens da Implementa√ß√£o</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-green-700">
                    <div>
                        <strong>Para o Usu√°rio:</strong>
                        <ul class="ml-4 list-disc">
                            <li>Sess√£o nunca expira inesperadamente</li>
                            <li>Navega√ß√£o sem interrup√ß√µes</li>
                            <li>Experi√™ncia fluida e transparente</li>
                        </ul>
                    </div>
                    <div>
                        <strong>Para a Seguran√ßa:</strong>
                        <ul class="ml-4 list-disc">
                            <li>Tokens sempre atualizados</li>
                            <li>Rota√ß√£o autom√°tica de refresh tokens</li>
                            <li>Rastreamento completo de atividades</li>
                        </ul>
                    </div>
                </div>
            </div>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>‚Ä¢ Monitore a expira√ß√£o do token (campo expiresAt)</li>
                        <li>‚Ä¢ Implemente refresh autom√°tico quando pr√≥ximo do vencimento</li>
                        <li>‚Ä¢ Use GET /api/auth/validate para verificar se token ainda √© v√°lido</li>
                        <li>‚Ä¢ Ao fazer logout: chame POST /api/auth/logout e limpe localStorage</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Tratamento de Erros -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">‚ö†Ô∏è Tratamento de Erros</h2>
            
            <div class="space-y-4">
                <div class="p-4 border border-red-200 bg-red-50 rounded-lg">
                    <h3 class="font-semibold text-red-800 mb-2">üö´ Erros Comuns de Login</h3>
                    <div class="code-block">
<pre>{
  "isSuccess": false,
  "data": null,
  "errors": ["Invalid email or password"]
}</pre>
                    </div>
                    <p class="text-sm text-red-700 mt-2">
                        <strong>Poss√≠veis causas:</strong> Credenciais incorretas no Auth0, usu√°rio n√£o existe no GrydAuth, usu√°rio inativo
                    </p>
                </div>

                <div class="p-4 border border-amber-200 bg-amber-50 rounded-lg">
                    <h3 class="font-semibold text-amber-800 mb-2">üîí Erro de Autoriza√ß√£o (403)</h3>
                    <div class="code-block">
<pre>HTTP 403 Forbidden
"AppId n√£o informado."</pre>
                    </div>
                    <p class="text-sm text-amber-700 mt-2">
                        <strong>Solu√ß√£o:</strong> Verificar se o header X-App-Id est√° sendo enviado corretamente
                    </p>
                </div>

                <div class="p-4 border border-blue-200 bg-blue-50 rounded-lg">
                    <h3 class="font-semibold text-blue-800 mb-2">üîë Token Expirado (401)</h3>
                    <div class="code-block">
<pre>HTTP 401 Unauthorized</pre>
                    </div>
                    <p class="text-sm text-blue-700 mt-2">
                        <strong>Solu√ß√£o:</strong> Fazer refresh do token ou solicitar novo login
                    </p>
                </div>
            </div>
        </div>

        <!-- C√≥digo de Exemplo -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üíª Exemplo de Implementa√ß√£o JavaScript</h2>
            
            <div class="code-block">
<pre>// Configura√ß√£o do cliente API com suporte a criptografia
class GrydAuthClient {
    constructor(baseUrl, appId) {
        this.baseUrl = baseUrl;
        this.appId = appId;
        this.token = localStorage.getItem('gryd_token');
        this.publicKey = null;
    }

    // Headers padr√£o
    getHeaders() {
        const headers = {
            'Content-Type': 'application/json',
            'X-App-Id': this.appId
        };
        
        if (this.token) {
            headers['Authorization'] = `Bearer ${this.token}`;
        }
        
        return headers;
    }

    // Obter chave p√∫blica para criptografia
    async getPublicKey() {
        if (!this.publicKey) {
            const response = await fetch(`${this.baseUrl}/api/auth/public-key`, {
                headers: this.getHeaders()
            });
            
            const data = await response.json();
            this.publicKey = data.publicKey;
            this.keyId = data.keyId;
        }
        
        return this.publicKey;
    }

    // Criptografar senha usando JSEncrypt
    async encryptPassword(password) {
        // Instale: npm install jsencrypt
        const JSEncrypt = require('jsencrypt').JSEncrypt;
        
        const publicKey = await this.getPublicKey();
        const encrypt = new JSEncrypt();
        
        // Formatar chave p√∫blica para JSEncrypt
        const formattedKey = `-----BEGIN PUBLIC KEY-----\n${publicKey}\n-----END PUBLIC KEY-----`;
        encrypt.setPublicKey(formattedKey);
        
        const encrypted = encrypt.encrypt(password);
        if (!encrypted) {
            throw new Error('Failed to encrypt password');
        }
        
        return encrypted;
    }

    // Login tradicional com senha criptografada
    async login(email, password, useEncryption = true) {
        let requestBody;
        
        if (useEncryption) {
            const encryptedPassword = await this.encryptPassword(password);
            requestBody = {
                email,
                password: encryptedPassword,
                isPasswordEncrypted: true
            };
        } else {
            // Modo de compatibilidade - n√£o recomendado
            requestBody = {
                email,
                password,
                isPasswordEncrypted: false
            };
        }

        const response = await fetch(`${this.baseUrl}/api/auth/login`, {
            method: 'POST',
            headers: this.getHeaders(),
            body: JSON.stringify(requestBody)
        });
        
        const result = await response.json();
        
        if (result.isSuccess) {
            this.token = result.data.token;
            localStorage.setItem('gryd_token', this.token);
            localStorage.setItem('gryd_user', JSON.stringify(result.data.user));
            return result.data;
        }
        
        throw new Error(result.errors.join(', '));
    }

    // Social login (sem altera√ß√£o na criptografia - Auth0 handles)
    async socialLogin(provider, accessToken) {
        const response = await fetch(`${this.baseUrl}/api/auth/social-login`, {
            method: 'POST',
            headers: this.getHeaders(),
            body: JSON.stringify({ provider, accessToken })
        });
        
        const result = await response.json();
        
        if (result.isSuccess) {
            this.token = result.data.token;
            localStorage.setItem('gryd_token', this.token);
            localStorage.setItem('gryd_user', JSON.stringify(result.data.user));
            return result.data;
        }
        
        throw new Error(result.errors.join(', '));
    }

    // Validar token
    async validateToken() {
        const response = await fetch(`${this.baseUrl}/api/auth/validate`, {
            headers: this.getHeaders()
        });
        
        return response.ok;
    }

    // Logout
    async logout() {
        if (this.token) {
            await fetch(`${this.baseUrl}/api/auth/logout`, {
                method: 'POST',
                headers: this.getHeaders(),
                body: JSON.stringify({ token: this.token })
            });
        }
        
        this.token = null;
        localStorage.removeItem('gryd_token');
        localStorage.removeItem('gryd_user');
    }

    // Obter usu√°rio atual
    getCurrentUser() {
        const user = localStorage.getItem('gryd_user');
        return user ? JSON.parse(user) : null;
    }
}

// Uso do cliente
const authClient = new GrydAuthClient('https://api.exemplo.com', 'meu-app-id');

// Login
authClient.login('usuario@exemplo.com', 'senha123')
    .then(data => {
        console.log('Login realizado:', data);
        // Redirecionar para √°rea autenticada
    })
    .catch(error => {
        console.error('Erro no login:', error.message);
    });
</pre>
            </div>
        </div>

        <!-- Considera√ß√µes Importantes -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üìù Considera√ß√µes Importantes</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h3 class="font-semibold text-blue-800 mb-2">üîê Seguran√ßa</h3>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>‚Ä¢ Sempre use HTTPS em produ√ß√£o</li>
                        <li>‚Ä¢ Criptografia RSA 2048-bit para senhas</li>
                        <li>‚Ä¢ Chave p√∫blica pode ser interceptada (√© seguro)</li>
                        <li>‚Ä¢ O JWT cont√©m roles e permissions</li>
                        <li>‚Ä¢ AppId √© obrigat√≥rio para autoriza√ß√£o</li>
                        <li>‚Ä¢ Tokens t√™m expira√ß√£o definida</li>
                    </ul>
                </div>

                <div class="p-4 bg-purple-50 border border-purple-200 rounded-lg">
                    <h3 class="font-semibold text-purple-800 mb-2">üîë Criptografia</h3>
                    <ul class="text-sm text-purple-700 space-y-1">
                        <li>‚Ä¢ RSA-OAEP-SHA256 para m√°xima seguran√ßa</li>
                        <li>‚Ä¢ Chaves rotacionadas automaticamente</li>
                        <li>‚Ä¢ Senhas nunca trafegam em texto plano</li>
                        <li>‚Ä¢ Instale jsencrypt: npm install jsencrypt</li>
                        <li>‚Ä¢ Fallback para texto plano se necess√°rio</li>
                    </ul>
                </div>

                <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                    <h3 class="font-semibold text-green-800 mb-2">‚ö° Performance</h3>
                    <ul class="text-sm text-green-700 space-y-1">
                        <li>‚Ä¢ Cache dados do usu√°rio localmente</li>
                        <li>‚Ä¢ Implemente refresh autom√°tico</li>
                        <li>‚Ä¢ Use interceptors para headers</li>
                        <li>‚Ä¢ Monitore expira√ß√£o do token</li>
                    </ul>
                </div>

                <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <h3 class="font-semibold text-yellow-800 mb-2">üîÑ Estados</h3>
                    <ul class="text-sm text-yellow-700 space-y-1">
                        <li>‚Ä¢ N√£o autenticado: mostrar login</li>
                        <li>‚Ä¢ Autenticando: mostrar loading</li>
                        <li>‚Ä¢ Autenticado: mostrar aplica√ß√£o</li>
                        <li>‚Ä¢ Erro: mostrar mensagem adequada</li>
                    </ul>
                </div>

                <div class="p-4 bg-purple-50 border border-purple-200 rounded-lg">
                    <h3 class="font-semibold text-purple-800 mb-2">üõ†Ô∏è Desenvolvimento</h3>
                    <ul class="text-sm text-purple-700 space-y-1">
                        <li>‚Ä¢ Teste todos os cen√°rios de erro</li>
                        <li>‚Ä¢ Implemente logs adequados</li>
                        <li>‚Ä¢ Valide permiss√µes no frontend</li>
                        <li>‚Ä¢ Configure environment variables</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Refer√™ncias -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üìö Documenta√ß√£o Adicional</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-3">üìñ Documentos Relacionados</h3>
                    <ul class="text-sm text-gray-700 space-y-2">
                        <li>‚Ä¢ <a href="../REFRESH-TOKEN-STRATEGIES.html" class="text-blue-600 hover:underline">
                            üîÑ Guia Completo de Estrat√©gias de Refresh Token
                        </a></li>
                        <li>‚Ä¢ <a href="../CONFIGURATION-GUIDE.html" class="text-blue-600 hover:underline">
                            ‚öôÔ∏è Guia de Configura√ß√£o do GrydAuth
                        </a></li>
                        <li>‚Ä¢ <a href="../TROUBLESHOOTING-GUIDE.html" class="text-blue-600 hover:underline">
                            üîß Troubleshooting e Solu√ß√£o de Problemas
                        </a></li>
                        <li>‚Ä¢ <a href="../MIGRATION-GUIDE.html" class="text-blue-600 hover:underline">
                            üì¶ Guia de Migra√ß√£o entre Vers√µes
                        </a></li>
                    </ul>
                </div>
                
                <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-3">üí° Pr√≥ximos Passos</h3>
                    <ul class="text-sm text-gray-700 space-y-2">
                        <li>‚Ä¢ Escolha a estrat√©gia adequada para seu projeto</li>
                        <li>‚Ä¢ Configure o appsettings.json conforme necess√°rio</li>
                        <li>‚Ä¢ Implemente o frontend seguindo os exemplos</li>
                        <li>‚Ä¢ Teste todos os cen√°rios de autentica√ß√£o</li>
                        <li>‚Ä¢ Configure monitoramento em produ√ß√£o</li>
                    </ul>
                </div>
            </div>

            <div class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-500">
                <h4 class="font-semibold text-blue-800 mb-2">üí¨ Suporte e Feedback</h4>
                <p class="text-sm text-blue-700">
                    Para d√∫vidas espec√≠ficas sobre implementa√ß√£o das estrat√©gias de refresh token, 
                    consulte o documento <strong>REFRESH-TOKEN-STRATEGIES.md</strong> que cont√©m 
                    compara√ß√µes detalhadas, exemplos de c√≥digo e orienta√ß√µes de migra√ß√£o.
                </p>
            </div>
        </div>
    </div>
</body>
</html>
